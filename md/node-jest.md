<< [На главную](../README.md)

# node : Jest - тестирование кода

---

Навигация:

- [node : Jest - тестирование кода](#node--jest---тестирование-кода)
  - [Jest : Установка](#jest--установка)
  - [Jest : Настройка](#jest--настройка)
  - [Jest : Структура файлов](#jest--структура-файлов)
  - [Jest : матчеры](#jest--матчеры)
    - [Общие](#общие)
    - [Строка](#строка)
    - [Массив](#массив)
    - [Объект](#объект)
  - [Jest : хуки](#jest--хуки)
  - [Jest : Использование](#jest--использование)

---

## Jest : Установка

[Официальный сайт](https://jestjs.io/)

```bash
npm install jest --save-dev
```

## Jest : Настройка

Для поддержки синтаксиса ECMAScript модулей необходимо настроить node.
Добавьте в корень проекта файл `.npmrc`

```bash
node-options=--experimental-vm-modules
```

## Jest : Структура файлов

Файлы тестов располагаются в директории `__tests__` (обычно в корне проекта).  
В этой директории можно создавать любую струкутру. Jest найдёт все тесты.

Именование файлов с тестами должно быть таким: `<name>.test.js`.  
Где `<name>`, как правило, совпадает с названием тестируемого модуля.

Для тестов Jest предоставляет две глобальные функции: `test` и `expect`;

```js
import reverse from '../src/reverse.js'; // импорт тестируемого модуля

test('reverse', () => {
  // 'reverse' — произвольное название теста
  expect(reverse('hello')).toEqual('olleh');
  // ожидается, что ____ будет равно ____
  // expect ____ to be equal ____
});
```

`toEqual` — матчер сравнения.

## Jest : матчеры

Методы сравнения полученного и ожидаемого результатов.

- [Документация](https://jestjs.io/docs/expect)

### Общие

```js
.toBe(value) // равенство (по ссылке)
.toEqual(value) // равенство (по значению)
```

```js
.toBeTruthy() // true
.toBeFalsy() // false
.toBeNull() // null
.toBeUndefined() // undefined
```

```js
.not.____() // противоположная проверка
// подходит для всех матчеров
```

```js
expect(() => ____).toThrow(); // error
// проверяемая функция обёрнута анонимной лямбда-функцией,
// чтобы матчер смог перехватить ошибку
```

### Строка

```js
.toMatch(string | regexp) // содержит подстроку
```

### Массив

```js
.toHaveLength(number) // длина массива
```

```js
.toContain(value) // содержит элемент
```

### Объект

```js
.toHaveProperty(key, value) // ключ, значение (не обязательно)
.toHaveProperty('key.key', value) // ключ (с глубиной), значение (не обязательно)
.toHaveProperty(['key', 'key' ], value); // ключ (с глубиной), значение (не обязательно)
```

```js
.toMatchObject(object) // содержит структуру object как часть себя
```

## Jest : хуки

Функции, запускаемые до или после выполнения каждой из директив `test()`.

- [Документация](https://jestjs.io/docs/api#methods)

```js
beforeEach(() => {}); // перед каждым test()
afterEach(() => {}); // после каждого test()
```

```js
beforeAll(() => {}); // перед всеми тестами (один раз)
afterAll(() => {}); // после всех тестов (один раз)
```

## Jest : Использование

```bash
npx jest  # запуск тестов
```
